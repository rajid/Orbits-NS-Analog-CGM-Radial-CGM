import e from"clock";import t from"document";import{me as n}from"appbit";import{me as l}from"device";import*as msg from"messaging";import*as util from"../common/utils";import{readFileSync as i}from"fs";import{writeFileSync as a}from"fs";import{unlinkSync as o}from"fs";import{statSync as s}from"fs";import{vibration as r}from"haptics";import m from"./graph.js";import{inbox as d}from"file-transfer";import{display as c}from"display";import{memory as y}from"system";import{charger as u}from"power";let g=[300,300];function p(){return"mmol/L"===te?util.oneDecimal(util.mmol(ne)):ne}function f(e){return"mmol/L"===te?util.mmol(e):e}function h(e){return"mmol/L"===te?util.mgdl(e):e}y.monitor.onmemorypressurechange=function(){switch(y.monitor.pressure){case"normal":case"high":R.r=10;break;case"critical":R.r=30}};let B=t.getElementById("noteBG"),I=t.getElementById("noteMess"),b=t.getElementById("noteTime"),T=t.getElementById("dismiss"),k=t.getElementById("snooze");var x=[],E=[],w=[],$=[];let v=-1,S=0,D=-1;l.screen||(l.screen={width:348,height:250});const z=l.screen.width,G=l.screen.height;import{clockFace as C}from"./clock.js";let H=new C,M=H.appName(),j="radialcgm"==M?1:0,L="orbitsns"==M?1:0;e.granularity=L?"minutes":"seconds";let U=t.getElementById("arrow"),A=t.getElementById("circle"),N=t.getElementById("sgv"),P=t.getElementById("sgvbutton"),R=t.getElementById("state"),O=t.getElementById("forceUpdate"),W=0;var F,V,Y,q,J,K,Q;try{Y=t.getElementById("graphWindow"),q=Y.getElementById("graphIOB"),J=Y.getElementById("graphCOB"),K=Y.getElementById("GraphDismiss"),Q=0,K.onclick=Wt,V=j?t.getElementById("docGraph"):Y.getElementById("docGraph"),F=new m(V)}catch(e){}function X(){dn=new Date,c.on&&Z&&ae<dn.getTime()&&qe()}O.onclick=function(){Z&&qe()},c.addEventListener("change",X);let Z=!1;var _=[],ee=[];let te="bg/dl",ne=0,le=0,ie=0,ae=0,oe=0,se=0,re=0,me=0,de=0,ce=0,ye=0,ue=!1,ge=0,pe=0,fe=0,he=0,Be=0,Ie=3,be=12;var Te,ke,xe,Ee;function we(e){Math.abs(oe)>20||ge>0&&Math.abs(f(oe))>=ge?e.style.fill="red":e.style.fill=Xe?"yellow":"lightgreen"}function $e(e){return e>0&&p()>e}function ve(e){return e>0&&p()<e}const Se=1*G,De=.55*G;function ze(){dn=new Date;let e=t.getElementById("month"),n=t.getElementById("date"),l=t.getElementById("hour"),i=t.getElementById("minute");dn.getTime()<W?(e.text=`${Ee}`,n.text=`${xe}`,l.text=`${Te}`,i.text=`${util.zeroPad(ke)}`,e.style.display="inline",n.style.display="inline",l.style.display="inline",i.style.display="inline",U.style.display="none",N.style.display="none",R.style.display="none",A.style.display="none",Jt.style.display="none"):(e.style.display="none",n.style.display="none",l.style.display="none",i.style.display="none",Z&&(Ge(),R.style.display="inline"),Jt.style.display="inline",W=0)}function Ge(){if(dn=new Date,Z&&0==W&&0!=le){N.text=`${p()}`,N.style.fill=F.setColor(p());let e=dn.getTime()-le,t=1;(e/=6e4)<5?t=1:(e>5&&(e-=5),(t=(20-e)/20)<0&&(t=0),t>1&&(t=1)),N.style.fillOpacity=t,N.style.display="inline",(de||ce||me||ye)&&p()>0&&0==t&&(N.style.fillOpacity=1,N.text=`${Math.floor(e)} mins old`);let n=90*oe/20;(n=90-n)<0&&(n=0),n>180&&(n=180),tt>cn?(A.style.display="inline",U.style.display="none",we(A),cn=dn.getTime()):(A.style.display="none",U.style.display="inline",U.groupTransform.rotate.angle=n,we(U),U.style.opacity=t),Ce()}}function Ce(){R.style.fill=Ne>0?"red":0==Ne?"green":"white"}function He(){c.poke(),u.connected&&setTimeout(He,5e3)}function Me(){let e=new Date;Te=e.getHours(),ke=e.getMinutes(),xe=e.getDate(),Ee=e.getMonth()+1,H.updateClock(Se,De,fe)}function je(e,t,n){if(!e.def||!t.def)return!1;let l=60*e.hours+e.minutes,i=60*t.hours+t.minutes,a=60*n.getHours()+n.getMinutes();if(l==i)return!1;if(l<i){if(l<a&&a<i)return!0}else{if(a>l)return!0;if(a<i)return!0}return!1}function Le(e){console.log("**** VibNudge *****"),(0==e||!je(Pe,Re,e)&&(0==jt||jt<e.getTime()))&&(It(g),c.poke())}function Ue(e){var t;try{s("forceExit");t=!0}catch(e){t=!1}if(t)Le(e);else{a("forceExit",{time:e},"json");s("forceExit");n.exit()}}u.onchange=He;let Ae=0,Ne=-1,Pe={def:!1},Re={def:!1};function Oe(e){var t;return dn=new Date,msg.peerSocket.readyState===msg.peerSocket.OPEN?(msg.peerSocket.send({command:e}),Ae=dn.getTime(),Ne<0?Ne--:Ne=-1,t=!0):(Ne>0?Ne++:Ne=1,t=!1),Ce(),Math.abs(Ne)>10&&(de>0||ce>0||me>0||ye>0)&&Ue(dn),t}var We=t.getElementById("clicker");function Fe(e){let t=new Date(e);if(null==e||isNaN(e))return fe=0,he=0,void(Be=0);fe=new Date(t.getTime()+24*Ie*60*60*1e3-60*be*60*1e3),he=fe.getHours(),Be=fe.getMinutes()}We.onclick=function(e){0==W?(W=(W=new Date).getTime()+5e3,setTimeout(ze,5e3),ze()):(W=0,ze())},e.ontick=(()=>Me());let Ve=0;function Ye(){clearTimeout(Ve),qe()}function qe(){Z&&(Oe("data")?(Ve&&clearTimeout(Ve),Ve=setTimeout(Ye,5e3)):(pe&&clearTimeout(pe),pe=setTimeout(qe,1e4)))}function Je(){return dn=new Date,$e(ce)&&dn.getTime()>=ot||ve(de)&&dn.getTime()>=at||$e(ye)&&dn.getTime()>=rt||ve(me)&&dn.getTime()>=st?ft():("inline"==mt.style.display&&ut(),"inline"==it.style.display&&(it.style.display="none"),0)}let Ke=0,Qe=0,Xe=!1;function Ze(e){if(Xe=!1,0==Ke||0==Qe)return;var t;let n=60*Ke*1e3;for(t=0;t<ee.length&&e.getTime()-ee[t]<n;t++)if(tt>=ee[t])return;try{Math.abs(p()-f(_[t]))>Qe&&(Xe=!0,Le(e))}catch(e){}}function _e(e){1==e?(0==Z&&(Z=!0,qe()),O.style.display="inline",R.style.display="inline"):(Z=!1,U.style.display="none",N.style.display="none",R.style.display="none",O.style.display="none",A.style.display="none"),Ge()}function et(){$e(me+1)&&(st=0),$e(de+1)&&(at=0),ve(ye-1)&&(rt=0),ve(ce-1)&&(ot=0)}let tt=0;msg.peerSocket.onmessage=(e=>{switch(dn=new Date,console.log("mess: "+e.data.key),console.log(`Pres: ${y.monitor.pressure} ${y.js.used} / ${y.js.total}`),e.data.key){case"bg":Ne=0;let t=0;if(e.data.bg>0){ne=e.data.bg,le=e.data.date,ie=e.data.period,oe=e.data.delta;let n=3e5;j&&(n=6e5),le-ee[0]>=n&&(t=1,_.unshift(ne),ee.unshift(le),console.log(`Saved ${ne}`))}for(;ee.length>0&&(ee.length>F.maxBGs()||ee[ee.length-1]<dn.getTime()-396e5);)_.pop(),ee.pop()>tt&&(tt=0);dn.getTime()-le>=12e5&&(de||ce||me||ye)?Le(dn):(et(),ge>0&&Math.abs(f(oe))>=ge?Le(dn):!Je()&&ne<=40?Le(0):Ze(dn),t&&(Tt&&Vt(_,ee),j&&F.updateRgraph(_,ee,G,z,tt))),e.data.update>0&&(ae=e.data.update,pe&&clearTimeout(pe),pe=setTimeout(qe,ae-dn.getTime())),_e(1);break;case"ack":Ne=0,Ve&&(clearTimeout(Ve),Ve=0),Ce();break;case"podchange":let n=parseInt(e.data.value);Ie=parseInt(e.data.period),be=parseInt(e.data.before),Fe(n),a("podchange",{podchange:n,period:Ie,before:be},"json");break;case"alarm":At(e.data.number,e.data.value);break;case"mess":Pt(e.data.number,e.data.value);break;case"alarmsnooze":yn[e.data.number]=parseInt(e.data.value),a("alarmSnooze",yn,"json");break;case"timer":lt(e.data.number);break;case"limits":let l=e.data.UL,i=e.data.L,o=e.data.H,s=e.data.UH,r=e.data.diff;F.setUL(h(l)),F.setL(h(i)),F.setH(h(o)),F.setUH(h(s)),me=l,de=i,ce=o,ye=s,ge=r,F.setULC(e.data.ULC),F.setLC(e.data.LC),F.setUHC(e.data.UHC),F.setHC(e.data.HC),F.setIRC(e.data.IRC),F.updateRgraph(_,ee,G,z,tt),ct(),Je();break;case"long":Ke=e.data.period,Qe=e.data.diff;break;case"cal":tt=e.data.number;break;case"warn-start":if(""==e.data.value)Pe={def:!1};else{let t=e.data.value.split(":");Pe={hours:parseInt(t[0]),minutes:parseInt(t[1]),def:!0}}a("warn-start",Pe,"json");break;case"warn-end":if(""==e.data.value)Re={def:!1};else{let t=e.data.value.split(":");Re={hours:parseInt(t[0]),minutes:parseInt(t[1]),def:!0}}a("warn-end",Re,"json");break;case"units":te=e.data.value,Je();break;case"bgFont1":N.style.fontSize=e.data.number;break;case"bgsnooze":gn[e.data.number]=parseInt(e.data.value),a("BGSnooze",gn,"json");break;case"defBgSz":pn=e.data.number;break;case"defAlmSz":un=e.data.number;break;case"ns":a("ns",{nsconfigured:e.data.number},"json"),_e(e.data.number);break;case"graphdata":let m=e.data.data;for(let t=0;t<e.data.data.length;t++)_[t]=m[t].s,ee[t]=m[t].d;Tt&&Vt(_,ee);break;case"gradient":H.setGradColor(e.data.value);break;case"hour":H.setHourColor(e.data.value);break;case"minute":H.setMinColor(e.data.value);break;case"second":H.setSecColor(e.data.value);break;case"iobcob":se=e.data.iob,re=e.data.cob,q.text=`${se}`,J.text=`${re}`;break;case"urgent":ue=e.data.number,Je()}try{o("forceExit")}catch(e){}});let nt=t.getElementById("timerWindow");function lt(e){let t=nt.getElementById("timer"),n=0,l=0;l=60*e,n=setInterval(function(){let e=Math.floor(l/60),i=l-60*e;if(t.text=`${util.zeroPad(e)}:${util.zeroPad(i)}`,--l<0)return l=0,clearInterval(n),nt.style.display="none",void It(g);l<5&&r.start("bump"),nt.style.display="inline",c.poke()},1e3)}msg.peerSocket.onopen=(e=>{Z&&qe()});let it=t.getElementById("snoozeBGTimes"),at=0,ot=0,st=0,rt=0,mt=t.getElementById("BGgraph"),dt=t.getElementById("suppress");function ct(){a("BGLimits",{BGUL:me,BGLow:de,BGHigh:ce,BGUH:ye,LS:at,HS:ot,ULS:st,UHS:rt,BGDiff:ge},"json")}function yt(e){it.style.display="none",dn=new Date,ve(me)?(st=dn.getTime()+6e4*e,at=st):$e(ye)?(rt=dn.getTime()+6e4*e,ot=rt):$e(ce)?ot=dn.getTime()+6e4*e:ve(de)&&(at=dn.getTime()+6e4*e),ct()}function ut(){I.style.display="none",B.style.display="none",b.style.display="none",dt.style.display="none",mt.style.display="none",r.stop(),clearTimeout(S),qt(2)}function gt(){ut();for(let e=0;e<8;e++){let t=it.getElementById(e.toString());t.getElementById("text").text=gn[e];let n=gn[e];t.onclick=function(){yt(n)}}it.style.display="inline"}function pt(){clearTimeout(S),S=setTimeout(wt,1e4)}function ft(){if(0==p())return 0;if(p()>40){if(0==p()||(0==ce||p()<ce)&&(0==ye||p()<ye)&&(0==de||p()>de)&&(0==me||p()>me))return 0;if("inline"==it.style.display)return 0}dn=new Date,"none"!=on.style.display&&an(),B.style.fill=F.setColor(p()),B.style.display="inline",T.style.display="none",k.style.display="none",b.text=`${dn.getHours()}:${util.zeroPad(dn.getMinutes())}`,b.style.display="inline";var e=!1;return $e(ye)?(I.text=`BG of ${p()} is higher than urgent high limit of ${ye}`,e=!0):$e(ce)?(I.text=`BG of ${p()} is higher than high limit of ${ce}`,0==ye&&(e=!0)):ve(me)?(I.text=`BG of ${p()} is lower than urgent limit of ${me}`,e=!0):ve(de)&&(I.text=`BG of ${p()} is lower than limit of ${de}`,0==me&&(e=!0)),I.onclick=!e&&pn>0?function(){ut(),yt(pn)}:void 0,I.style.display="inline",I.style.fontSize=40,!e&&ue&&je(Pe,Re,dn)||(It(g),c.poke(),pt()),mt.onactivate=xt,mt.style.display="inline",dt.style.display="inline",dt.onactivate=gt,1}var ht,Bt;function It(e){ht=e,Bt=0,bt()}function bt(){r.start("confirmation-max"),Bt<ht.length&&setTimeout(bt,ht[Bt++])}let Tt=!1;function kt(){dn=new Date,Tt=!0,F.reset(),_.length>=F.maxBGs()?Vt(_,ee):Oe("graph")}function xt(){Q=ft,Y.style.display="inline",kt()}function Et(e){if(dn=new Date,(-1==v||v==e)&&void 0!==x[e]){"none"!=on.style.display&&an(),v=e,B.style.display="inline",B.style.fill="white",b.text=`${x[e].hour}:${x[e].minute}`,b.style.display="inline",T.style.display="inline",k.style.display="inline",T.onactivate=Dt,k.onactivate=Ct;try{let t=i("mess"+e,"json");I.text=t.message}catch(e){I.text="<no message>"}I.style.display="inline",I.style.fontSize=40,I.onclick=un>0?function(){Ht(),zt(un)}:void 0,It(g),c.poke(),pt()}}function wt(){"inline"==I.style.display&&(r.start("nudge-max"),c.poke(),pt())}function $t(e){dn=new Date;let t=new Date;t.setHours(x[e].hour,x[e].minute,0);let n=t.getTime()-dn.getTime();n+=864e5,E[e]=setTimeout(vt,n,e)}function vt(e){if(E[e]>=0)return Et(e),void $t(e)}function St(){dn=new Date;for(let e=0;e<10;e++)w[e]>0&&w[e]-dn.getTime()<0&&(v=e,qt(2))}function Dt(){dn=new Date,I.style.display="none",B.style.display="none",b.style.display="none",T.style.display="none",k.style.display="none",r.stop(),Ut(v),D=v,Nt(v),St(),v=-1}function zt(e){let t=e;dn=new Date,Ut(v),w[v]=dn.getTime()+60*t*1e3,$[v]=setTimeout(vt,60*t*1e3,v),D=v,Nt(v),St(),v=-1,Gt.style.display="none"}let Gt=t.getElementById("snoozeTimes");function Ct(){Mt("BG")}function Ht(){Qt.style.display="none",tn.style.display="none",I.style.display="none",B.style.display="none",b.style.display="none",T.style.display="none",k.style.display="none",clearTimeout(S),r.stop()}function Mt(e){Ht();for(let t=0;t<8;t++){let n=Gt.getElementById(t.toString());n.getElementById("text").text=yn[t];let l=yn[t];switch(e){case"BG":n.onclick=function(){zt(l)};break;case"comm":n.onclick=function(){Lt(l)}}}Gt.style.display="inline"}let jt=0;function Lt(e){dn=new Date,jt=dn.getTime()+60*e*1e3;new Date(jt);a("commsnooze",{time:jt},"json"),Gt.style.display="none"}function Ut(e){clearTimeout(S),clearTimeout($[e]),$[e]=0,w[e]=0}function At(e,t){if(E[e]&&(clearTimeout(E[e]),v==e&&(Ut(e),v=-1)),void 0===t||""==t||isNaN(parseInt(t))){x[e]=void 0;try{o("note"+e)}catch(e){}}else{{let n=t.split(":");x[e]={hour:n[0],minute:n[1]},dn=new Date;let l=new Date;l.setHours(n[0],n[1],0);let i=l.getTime()-dn.getTime();i<0&&(i+=864e5),E[e]=setTimeout(vt,i,e)}Nt(e)}}function Nt(e){a("note"+e,{hour:x[e].hour,minute:x[e].minute,snooze:w[e]},"json")}function Pt(e,t){a("mess"+e,{message:t},"json")}try{let e=i("podchange","json");Fe(e.podchange),Ie=e.period,be=e.before}catch(e){msg.peerSocket.readyState===msg.peerSocket.OPEN&&msg.peerSocket.send({command:"podchange"})}try{let e=i("BGLimits","json");me=e.BGUL,de=e.BGLow,ce=e.BGHigh,ye=e.BGUH,at=e.LS,ot=e.HS,st=e.ULS,rt=e.UHS,ge=e.BGDiff}catch(e){at=0,ot=0,st=0,rt=0,me=0,de=0,ce=0,ye=0,ge=0}for(let e=0;e<10;e++){dn=new Date;try{let t=i("note"+e,"json");var Rt,Ot;try{let e=t.time;Rt=(e=e.value).hour,Ot=e.minute}catch(e){Rt=t.hour,Ot=t.minute}console.log(`>>> Setting alarm for ${Rt}:${Ot}`),console.log(`snooze is ${t.snooze}`),t.snooze>0&&(t.snooze>dn.getTime()?($[e]=setTimeout(vt,t.snooze-dn.getTime(),e),console.log(`Snooze alarm set ${t.snooze-dn.getTime()}`),w[e]=t.snooze):(v=e,qt(10))),At(e,`${Rt}:${Ot}`)}catch(e){}}function Wt(){Tt=!1,Y.style.display="none",Q&&Q()}function Ft(e){_=[],ee=[];let t=i(e,"cbor");for(let e=0;e<t.length;e++)_[e]=t[e].s,ee[e]=t[e].d;t=[],F.updateRgraph(_,ee,G,z,tt),Tt&&Vt(_,ee)}function Vt(e,t){let n=500,l=0;var i,a;let o=Y.getElementById("graphMin"),s=Y.getElementById("graphMax"),r=Y.getElementById("graphMinAt"),m=Y.getElementById("graphMaxAt"),d=Y.getElementById("graphStartAt"),c=Y.getElementById("graphEndAt");var y,u,g;let p,h,B,I,b;try{y=Y.getElementById("graphStart"),u=Y.getElementById("graphEnd")}catch(e){}j&&(g=Y.getElementById("arcIn"),p=Y.getElementById("arcAbove"),h=Y.getElementById("arcBelow"),B=Y.getElementById("timeAbove"),I=Y.getElementById("timeIn"),b=Y.getElementById("timeBelow"));for(let o=0;o<e.length;o++)e[o]<n&&(n=e[o],i=t[o]),e[o]>l&&(l=e[o],a=t[o]);if(n--,l++,j){let e=0,t=0,i=0;for(let n=0;n<_.length;n++)ce>0&&_[n]>ce?e++:de>0&&_[n]<de?t++:i++;e=100*e/_.length,t=100*t/_.length,i=100*i/_.length,B.text=`High: ${util.oneDecimal(e)}%`,I.text=`In: ${util.oneDecimal(i)}%`,b.text=`Low: ${util.oneDecimal(t)}%`,o.text=`Min:${f(n)}`,s.text=`Max:${f(l)}`,g.startAngle=0,g.sweepAngle=360*i/100,g.style.fill=F.IRC(),p.startAngle=360*i/100,p.sweepAngle=360*e/100,p.style.fill=F.HC(),h.startAngle=p.startAngle+p.sweepAngle,h.sweepAngle=360*t/100,h.style.fill=F.LC()}else y.text=Yt(t[t.length-1]),u.text=Yt(t[0]),o.text=`${f(n)}`,s.text=`${f(l)}`;r.text=`${Yt(i)}`,m.text=`${Yt(a)}`,d.text=`Start: ${f(e[e.length-1])}`,c.text=`End: ${f(e[0])}`,q.text="--",J.text="--",Oe("iobcob"),F.setYRange(n,l),F.setBGColor("black"),F.update(e,t,tt),Y.style.display="inline"}function Yt(e){let t=new Date(e);return`${t.getHours()}:${util.zeroPad(t.getMinutes())}`}function qt(e){dn=new Date,-1!=v&&(w[v]-dn.getTime()<=1e3*e&&(w[v]=dn.getTime()+1e3*e),E[v]=setTimeout(vt,w[v]-dn.getTime(),v))}P.onclick=function(e){Y.style.display="inline",Q=0,kt()},d.onnewfile=(()=>{let e;do{(e=d.nextFile())&&Ft(e)}while(e)});let Jt=t.getElementById("menu"),Kt=Jt.getElementById("menuButton");Kt.onclick=function(){Qt.style.display="inline"};let Qt=t.getElementById("menuWindow1"),Xt=Qt.getElementsByClassName("menuItem");for(let e=0;e<Xt.length;e++){let t=Qt.getElementById(e.toString());t.onclick=function(){Zt(t.text)}}function Zt(e){switch(console.log(`menu id is ${e} lastalarm=${D}`),e){case"Redo last alarm":D>=0&&(E[v=D]=0,w[D]=0,qt(1)),Qt.style.display="none";break;case"Snooze Comm Warnings":Mt("comm");break;case"Current Suppressions":sn();break;case"Cancel Suppressions":rn();break;default:Qt.style.display="none"}}let _t=Qt.getElementById("more");_t.onclick=function(){tn.style.display="inline"};let en=Qt.getElementById("exit");en.onclick=an;let tn=t.getElementById("menuWindow2");Xt=tn.getElementsByClassName("menuItem");for(let e=0;e<Xt.length;e++){let t=tn.getElementById(e.toString());t.onclick=function(){nn(t.text)}}function nn(e){switch(e){case"Current Suppressions":sn();break;case"Cancel Suppressions":rn();break;default:tn.style.display="none"}}Xt=void 0;try{tn.getElementById("more").onclick=function(){}}catch(e){}let ln=tn.getElementById("exit");function an(){B.style.display="none",I.style.display="none",tn.style.display="none",Qt.style.display="none",on.style.display="none"}ln.onclick=an;let on=t.getElementById("noticeDismiss");function sn(){dn=new Date,I.text="",I.style.fontSize=30,B.style.fill="white";let e=ot-dn.getTime();ot&&e>0&&(I.text=`High BG: ${Math.floor(e/6e4)} mins`);let t=at-dn.getTime();at&&t>0&&(I.text.length>0&&(I.text+="\n"),I.text+=`Low BG: ${Math.floor(t/6e4)} mins`);let n=st-dn.getTime();st&&n>0&&(I.text.length>0&&(I.text+="\n"),I.text+=`Urg. Low BG: ${Math.floor(n/6e4)} mins`);let l=rt-dn.getTime();rt&&l>0&&(I.text.length>0&&(I.text+="\n"),I.text+=`Urg. High BG: ${Math.floor(l/6e4)} mins`),jt>dn.getTime()&&(I.text.length>0&&(I.text+="\n"),I.text+=`Comm: ${Math.floor((jt-dn.getTime())/6e4)} mins`);for(let e=0;e<10;e++)w[e]>0&&(I.text.length>0&&(I.text+="\n"),I.text+=`Alarm ${e+1}: ${Math.floor((w[e]-dn.getTime())/6e4)} mins`);0==I.text.length&&(I.text="No current suppressions"),tn.style.display="none",Qt.style.display="none",B.style.display="inline",I.style.display="inline",on.style.display="inline",on.onclick=an}function rn(){ot=0,at=0,rt=0,st=0,jt=0,ct();for(let e=0;e<10;e++)Ut(e),Nt(e);an(),Je()}let mn=t.getElementById("menu-list"),dn=new Date,cn=dn.getTime();try{let e=i("snooze","json"),t=e.timeout;-1!=e.number&&(t<dn.getTime()&&(t=dn.getTime()+1e4),t>dn.getTime()&&(t-dn.getTime()<=5e3&&(t=dn.getTime()+5e3),$[v]=setTimeout(vt,t-dn.getTime(),e.number),w[e.number]=t)),o("snooze")}catch(e){}let yn=[10,20,30,40,50,60,90,120];try{let e=i("alarmSnooze","json");for(let t=0;t<8;t++)e[t]&&(yn[t]=e[t])}catch(e){}let un=0,gn=[20,40,60,90,120,180,240,480];try{let e=i("BGSnooze","json");for(let t=0;t<8;t++)e[t]&&(gn[t]=e[t])}catch(e){}let pn=0;try{Pe=i("warn-start","json")}catch(e){Pe={def:!1}}try{Re=i("warn-end","json")}catch(e){Re={def:!1}}try{let e=i("commsnooze","json");e&&(jt=parseInt(e.time))}catch(e){}try{let e=i("ns","json");Z=e.nsconfigured}catch(e){Z=!1}Z&&setTimeout(qe,6e4),ze();
